var ImageFilters={utils:{initSampleCanvas:function(){var a=document.createElement("canvas"),b=a.getContext("2d");a.width=0;a.height=0;ImageFilters.getSamplecanvas=function(){return a};this.getSampleContext=function(){return b};this.createImageData=b.createImageData?function(a,f){return b.createImageData(a,f)}:function(a,b){return new ImageData(a,b)}},getSampleCanvas:function(){this.initSampleCanvas();return ImageFilters.getSamplecanvas()},getSampleContext:function(){this.initSampleCanvas();return this.getSampleContext()},
createImageData:function(a,b){this.initSampleCanvas();return this.createImageData(a,b)},clamp:function(a){return 255<a?255:0>a?0:a},buildMap:function(a){for(var b=[],e=0,f;256>e;e+=1)b[e]=255<(f=a(e))?255:0>f?0:f|0;return b},applyMap:function(a,b,e){for(var f=0,h=a.length;f<h;f+=4)b[f]=e[a[f]],b[f+1]=e[a[f+1]],b[f+2]=e[a[f+2]],b[f+3]=a[f+3]},mapRGB:function(a,b,e){this.applyMap(a,b,this.buildMap(e))},getPixelIndex:function(a,b,e,f,h){if(0>a||a>=e||0>b||b>=f)switch(h){case 1:a=0>a?0:a>=e?e-1:a;b=0>
b?0:b>=f?f-1:b;break;case 2:a=0>(a%=e)?a+e:a;b=0>(b%=f)?b+f:b;break;default:return null}return b*e+a<<2},getPixel:function(a,b,e,f,h,k){if(0>b||b>=f||0>e||e>=h)switch(k){case 1:b=0>b?0:b>=f?f-1:b;e=0>e?0:e>=h?h-1:e;break;case 2:b=0>(b%=f)?b+f:b;e=0>(e%=h)?e+h:e;break;default:return 0}b=e*f+b<<2;return a[b+3]<<24|a[b]<<16|a[b+1]<<8|a[b+2]},getPixelByIndex:function(a,b){return a[b+3]<<24|a[b]<<16|a[b+1]<<8|a[b+2]},copyBilinear:function(a,b,e,f,h,k,m,o){var j=0>b?b-1|0:b|0,p=0>e?e-1|0:e|0,b=b-j,e=e-
p,g,n=0,l=0,q=0;g=0;if(0<=j&&j<f-1&&0<=p&&p<h-1)if(g=p*f+j<<2,b||e)n=a[g+3]<<24|a[g]<<16|a[g+1]<<8|a[g+2],g+=4,l=a[g+3]<<24|a[g]<<16|a[g+1]<<8|a[g+2],g=g-8+(f<<2),q=a[g+3]<<24|a[g]<<16|a[g+1]<<8|a[g+2],g+=4,g=a[g+3]<<24|a[g]<<16|a[g+1]<<8|a[g+2];else{k[m]=a[g];k[m+1]=a[g+1];k[m+2]=a[g+2];k[m+3]=a[g+3];return}else if(n=this.getPixel(a,j,p,f,h,o),b||e)l=this.getPixel(a,j+1,p,f,h,o),q=this.getPixel(a,j,p+1,f,h,o),g=this.getPixel(a,j+1,p+1,f,h,o);else{k[m]=n>>16&255;k[m+1]=n>>8&255;k[m+2]=n&255;k[m+3]=
n>>24&255;return}o=1-b;j=1-e;a=((n>>16&255)*o+(l>>16&255)*b)*j+((q>>16&255)*o+(g>>16&255)*b)*e;f=((n>>8&255)*o+(l>>8&255)*b)*j+((q>>8&255)*o+(g>>8&255)*b)*e;h=((n&255)*o+(l&255)*b)*j+((q&255)*o+(g&255)*b)*e;b=((n>>24&255)*o+(l>>24&255)*b)*j+((q>>24&255)*o+(g>>24&255)*b)*e;k[m]=255<a?255:0>a?0:a|0;k[m+1]=255<f?255:0>f?0:f|0;k[m+2]=255<h?255:0>h?0:h|0;k[m+3]=255<b?255:0>b?0:b|0},rgbToHsl:function(a,b,e){var a=a/255,b=b/255,e=e/255,f=a>b?a>e?a:e:b>e?b:e,h=a<b?a<e?a:e:b<e?b:e,k=f-h,m=0,o=0,j=(h+f)/2;
0!==k&&(m=(a===f?(b-e)/k+(b<e?6:0):b===f?(e-a)/k+2:(a-b)/k+4)/6,o=0.5<j?k/(2-f-h):k/(f+h));return[m,o,j]},hslToRgb:function(a,b,e){var f;f=[];if(0===b)f=b=e=255*e+0.5|0,f=[f,b,e];else for(var b=0.5>=e?e*(b+1):e+b-e*b,e=2*e-b,a=a+1/3,h,k=0;3>k;k+=1)0>a?a+=1:1<a&&(a-=1),h=1>6*a?e+6*(b-e)*a:1>2*a?b:2>3*a?e+6*(b-e)*(2/3-a):e,f[k]=255*h+0.5|0,a-=1/3;return f}},Translate:function(){},Scale:function(){},Rotate:function(){},Affine:function(){},UnsharpMask:function(){},ConvolutionFilter:function(a,b,e,f,h,
k,m,o,j,p){var g=a.data,n=a.width,a=a.height,l=ImageFilters.utils.createImageData(n,a),q=l.data,h=h||1,k=k||0;!1!==m&&(m=!0);!1!==o&&(o=!0);for(var j=j||0,r=0,b=b>>1,e=e>>1,s=j>>16&255,c=j>>8&255,j=j&255,p=255*(p||0),d=0;d<a;d+=1)for(var i=0;i<n;i+=1,r+=4){for(var u=0,v=0,C=0,E=0,D=!1,I=0,G,F=-b;F<=b;F+=1){var z=d+F,B;0<=z&&z<a?B=z*n:o?B=d*n:D=!0;for(z=-e;z<=e;z+=1){var A=f[I++];if(0!==A){var t=i+z;0<=t&&t<n||(o?t=i:D=!0);D?(u+=A*s,v+=A*c,C+=A*j,E+=A*p):(t=B+t<<2,u+=A*g[t],v+=A*g[t+1],C+=A*g[t+2],
E+=A*g[t+3])}}}q[r]=255<(G=u/h+k)?255:0>G?0:G|0;q[r+1]=255<(G=v/h+k)?255:0>G?0:G|0;q[r+2]=255<(G=C/h+k)?255:0>G?0:G|0;q[r+3]=m?g[r+3]:255<(G=E/h+k)?255:0>G?0:G|0}return l},Binarize:function(a,b){var e=a.data,f=e.length,h=ImageFilters.utils.createImageData(a.width,a.height),k=h.data;isNaN(b)&&(b=0.5);for(var b=255*b,m=0;m<f;m+=4)k[m]=k[m+1]=k[m+2]=e[m]+e[m+1]+e[m+2]/3<=b?0:255,k[m+3]=255;return h},BlendAdd:function(a,b){for(var e=a.data,f=e.length,h=ImageFilters.utils.createImageData(a.width,a.height),
k=h.data,m=b.data,o,j=0;j<f;j+=4)k[j]=255<(o=e[j]+m[j])?255:o,k[j+1]=255<(o=e[j+1]+m[j+1])?255:o,k[j+2]=255<(o=e[j+2]+m[j+2])?255:o,k[j+3]=255;return h},BlendSubtract:function(a,b){for(var e=a.data,f=e.length,h=ImageFilters.utils.createImageData(a.width,a.height),k=h.data,m=b.data,o,j=0;j<f;j+=4)k[j]=0>(o=e[j]-m[j])?0:o,k[j+1]=0>(o=e[j+1]-m[j+1])?0:o,k[j+2]=0>(o=e[j+2]-m[j+2])?0:o,k[j+3]=255;return h}};
ImageFilters.BoxBlur=function(){var a=function(a,e,f,h,k){var m=2*k+1,o=k+1,j=f-1,p,g,n,l=0,q,r,s,c,d,i=[];c=0;for(p=256*m;c<p;c+=1)i[c]=c/m|0;for(d=0;d<h;d+=1){m=p=g=n=0;q=d;r=l<<2;m+=o*a[r];p+=o*a[r+1];g+=o*a[r+2];n+=o*a[r+3];for(c=1;c<=k;c+=1)r=l+(c<f?c:j)<<2,m+=a[r],p+=a[r+1],g+=a[r+2],n+=a[r+3];for(c=0;c<f;c+=1)r=q<<2,e[r]=i[m],e[r+1]=i[p],e[r+2]=i[g],e[r+3]=i[n],r=c+o,r>j&&(r=j),s=c-k,0>s&&(s=0),r=l+r<<2,s=l+s<<2,m+=a[r]-a[s],p+=a[r+1]-a[s+1],g+=a[r+2]-a[s+2],n+=a[r+3]-a[s+3],q+=h;l+=f}};return function(b,
e,f,h){for(var k=b.data,m=b.width,b=b.height,o=ImageFilters.utils.createImageData(m,b),j=o.data,p=ImageFilters.utils.createImageData(m,b).data,g=0;g<h;g+=1)a(g?j:k,p,m,b,e),a(p,j,b,m,f);return o}}();
ImageFilters.GaussianBlur=function(a,b){var e,f,h;switch(b){case 2:e=5;f=[1,1,2,1,1,1,2,4,2,1,2,4,8,4,2,1,2,4,2,1,1,1,2,1,1];h=52;break;case 3:e=7;f=[1,1,2,2,2,1,1,1,2,2,4,2,2,1,2,2,4,8,4,2,2,2,4,8,16,8,4,2,2,2,4,8,4,2,2,1,2,2,4,2,2,1,1,1,2,2,2,1,1];h=140;break;case 4:e=15;f=[2,2,3,4,5,5,6,6,6,5,5,4,3,2,2,2,3,4,5,7,7,8,8,8,7,7,5,4,3,2,3,4,6,7,9,10,10,11,10,10,9,7,6,4,3,4,5,7,9,10,12,13,13,13,12,10,9,7,5,4,5,7,9,11,13,14,15,16,15,14,13,11,9,7,5,5,7,10,12,14,16,17,18,17,16,14,12,10,7,5,6,8,10,13,15,
17,19,19,19,17,15,13,10,8,6,6,8,11,13,16,18,19,20,19,18,16,13,11,8,6,6,8,10,13,15,17,19,19,19,17,15,13,10,8,6,5,7,10,12,14,16,17,18,17,16,14,12,10,7,5,5,7,9,11,13,14,15,16,15,14,13,11,9,7,5,4,5,7,9,10,12,13,13,13,12,10,9,7,5,4,3,4,6,7,9,10,10,11,10,10,9,7,6,4,3,2,3,4,5,7,7,8,8,8,7,7,5,4,3,2,2,2,3,4,5,5,6,6,6,5,5,4,3,2,2];h=2044;break;default:e=3,f=[1,2,1,2,4,2,1,2,1],h=16}return ImageFilters.ConvolutionFilter(a,e,e,f,h,0,!1)};
ImageFilters.StackBlur=function(){function a(){this.a=this.b=this.g=this.r=0;this.next=null}var b=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,
404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,
323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],e=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,
23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return function(f,h){var k=f.width,m=f.height,o=ImageFilters.Clone(f),j=o.data,p,g,n,l,q,r,s,c,d,i,u,v,C,E,D,I,G,F,z,B,A,t,
J;p=h+h+1;var Q=k-1,N=m-1,H=h+1,K=H*(H+1)/2,L=new a,w=L,P,M=b[h],O=e[h];for(n=1;n<p;n+=1)w=w.next=new a,n==H&&(P=w);w.next=L;for(g=r=q=0;g<m;g+=1){D=I=G=F=s=c=d=i=0;u=H*(z=j[q]);v=H*(B=j[q+1]);C=H*(A=j[q+2]);E=H*(t=j[q+3]);s+=K*z;c+=K*B;d+=K*A;i+=K*t;w=L;for(n=0;n<H;n+=1)w.r=z,w.g=B,w.b=A,w.a=t,w=w.next;for(n=1;n<H;n+=1)l=q+((Q<n?Q:n)<<2),s+=(w.r=z=j[l])*(J=H-n),c+=(w.g=B=j[l+1])*J,d+=(w.b=A=j[l+2])*J,i+=(w.a=t=j[l+3])*J,D+=z,I+=B,G+=A,F+=t,w=w.next;n=L;w=P;for(p=0;p<k;p+=1)j[q]=s*M>>O,j[q+1]=c*M>>
O,j[q+2]=d*M>>O,j[q+3]=i*M>>O,s-=u,c-=v,d-=C,i-=E,u-=n.r,v-=n.g,C-=n.b,E-=n.a,l=r+((l=p+h+1)<Q?l:Q)<<2,D+=n.r=j[l],I+=n.g=j[l+1],G+=n.b=j[l+2],F+=n.a=j[l+3],s+=D,c+=I,d+=G,i+=F,n=n.next,u+=z=w.r,v+=B=w.g,C+=A=w.b,E+=t=w.a,D-=z,I-=B,G-=A,F-=t,w=w.next,q+=4;r+=k}for(p=0;p<k;p+=1){I=G=F=D=c=d=i=s=0;q=p<<2;u=H*(z=j[q]);v=H*(B=j[q+1]);C=H*(A=j[q+2]);E=H*(t=j[q+3]);s+=K*z;c+=K*B;d+=K*A;i+=K*t;w=L;for(n=0;n<H;n+=1)w.r=z,w.g=B,w.b=A,w.a=t,w=w.next;l=k;for(n=1;n<=h;n+=1)q=l+p<<2,s+=(w.r=z=j[q])*(J=H-n),c+=
(w.g=B=j[q+1])*J,d+=(w.b=A=j[q+2])*J,i+=(w.a=t=j[q+3])*J,D+=z,I+=B,G+=A,F+=t,w=w.next,n<N&&(l+=k);q=p;n=L;w=P;for(g=0;g<m;g+=1)l=q<<2,j[l]=s*M>>O,j[l+1]=c*M>>O,j[l+2]=d*M>>O,j[l+3]=i*M>>O,s-=u,c-=v,d-=C,i-=E,u-=n.r,v-=n.g,C-=n.b,E-=n.a,l=p+((l=g+H)<N?l:N)*k<<2,s+=D+=n.r=j[l],c+=I+=n.g=j[l+1],d+=G+=n.b=j[l+2],i+=F+=n.a=j[l+3],n=n.next,u+=z=w.r,v+=B=w.g,C+=A=w.b,E+=t=w.a,D-=z,I-=B,G-=A,F-=t,w=w.next,q+=k}return o}}();
ImageFilters.Brightness=function(a,b){var e=a.data,f=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(e,f.data,function(a){a+=b;return 255<a?255:a});return f};
ImageFilters.BrightnessContrastGimp=function(a,b,e){for(var f=a.data,h=f.length,a=ImageFilters.utils.createImageData(a.width,a.height),k=a.data,m=Math.PI/4,b=b/100,e=0.99*e,e=e/100,e=Math.tan((e+1)*m),o=0,m=0;m<h;m+=4)o+=19595*f[m]+38470*f[m+1]+7471*f[m+2]>>16;o/=h/4;ImageFilters.utils.mapRGB(f,k,function(a){0>b?a*=1+b:0<b&&(a+=(255-a)*b);0!==e&&(a=(a-o)*e+o);return a+0.5|0});return a};
ImageFilters.BrightnessContrastPhotoshop=function(a,b,e){var f=a.data,a=ImageFilters.utils.createImageData(a.width,a.height),h=a.data,b=(b+100)/100,e=(e+100)/100;ImageFilters.utils.mapRGB(f,h,function(a){a*=b;a=(a-127.5)*e+127.5;return a+0.5|0});return a};
ImageFilters.Channels=function(a,b){var e;switch(b){case 2:e=[0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,1,0];break;case 3:e=[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0];break;default:e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,0]}return this.ColorMatrixFilter(a,e)};ImageFilters.Clone=function(a){return this.Copy(a,ImageFilters.utils.createImageData(a.width,a.height))};
ImageFilters.CloneBuiltin=function(a){var b=a.width,e=a.height,f=ImageFilters.utils.getSampleCanvas(),h=ImageFilters.utils.getSampleContext();f.width=b;f.height=e;h.putImageData(a,0,0);a=h.getImageData(0,0,b,e);f.width=0;f.height=0;return a};
ImageFilters.ColorMatrixFilter=function(a,b){var e=a.data,f=e.length,h=ImageFilters.utils.createImageData(a.width,a.height),k=h.data,m=b[0],o=b[1],j=b[2],p=b[3],g=b[4],n=b[5],l=b[6],q=b[7],r=b[8],s=b[9],c=b[10],d=b[11],i=b[12],u=b[13],v=b[14],C=b[15],E=b[16],D=b[17],I=b[18],G=b[19],F,z,B,A,t,J;for(z=0;z<f;z+=4)B=e[z],A=e[z+1],t=e[z+2],J=e[z+3],k[z]=255<(F=B*m+A*o+t*j+J*p+g)?255:0>F?0:F|0,k[z+1]=255<(F=B*n+A*l+t*q+J*r+s)?255:0>F?0:F|0,k[z+2]=255<(F=B*c+A*d+t*i+J*u+v)?255:0>F?0:F|0,k[z+3]=255<(F=B*
C+A*E+t*D+J*I+G)?255:0>F?0:F|0;return h};ImageFilters.ColorTransformFilter=function(a,b,e,f,h,k,m,o,j){var p=a.data,g=p.length,a=ImageFilters.utils.createImageData(a.width,a.height),n=a.data,l,q;for(l=0;l<g;l+=4)n[l]=255<(q=p[l]*b+k)?255:0>q?0:q,n[l+1]=255<(q=p[l+1]*e+m)?255:0>q?0:q,n[l+2]=255<(q=p[l+2]*f+o)?255:0>q?0:q,n[l+3]=255<(q=p[l+3]*h+j)?255:0>q?0:q;return a};ImageFilters.Copy=function(a,b){for(var e=a.data,f=e.length,h=b.data;f--;)h[f]=e[f];return b};
ImageFilters.Crop=function(a,b,e,f,h){var k=a.data,m=a.width,o=a.height,a=ImageFilters.utils.createImageData(f,h),j=a.data,p=Math.max(b,0),g=Math.max(e,0),n=Math.min(b+f,m),h=Math.min(e+h,o),b=p-b,l,o=g;for(dstRow=g-e;o<h;o+=1,dstRow+=1){e=p;for(dstCol=b;e<n;e+=1,dstCol+=1)g=o*m+e<<2,l=dstRow*f+dstCol<<2,j[l]=k[g],j[l+1]=k[g+1],j[l+2]=k[g+2],j[l+3]=k[g+3]}return a};
ImageFilters.CropBuiltin=function(a,b,e,f,h){var k=a.width,m=a.height,o=ImageFilters.utils.getSampleCanvas(),j=ImageFilters.utils.getSampleContext();o.width=k;o.height=m;j.putImageData(a,0,0);a=j.getImageData(b,e,f,h);o.width=0;o.height=0;return a};
ImageFilters.Desaturate=function(a){for(var b=a.data,e=b.length,a=ImageFilters.utils.createImageData(a.width,a.height),f=a.data,h=0;h<e;h+=4){var k=b[h],m=b[h+1],o=b[h+2];f[h]=f[h+1]=f[h+2]=((k>m?k>o?k:o:m>o?m:o)+(k<m?k<o?k:o:m<o?m:o))/2+0.5|0;f[h+3]=b[h+3]}return a};
ImageFilters.DisplacementMapFilter=function(a,b,e,f,h,k,m,o,j){var p=a.data,g=a.width,n=a.height,a=ImageFilters.Clone(a),l=a.data;e||(e=0);f||(f=0);h||(h=0);k||(k=0);m||(m=0);o||(o=0);j||(j=2);var q=b.width,r=b.data,s=q+e,b=b.height+f,c,d,i,u,v;for(u=0;u<g;u+=1)for(v=0;v<n;v+=1)c=v*g+u<<2,u<e||v<f||u>=s||v>=b?d=c:(i=(v-f)*q+(u-e)<<2,d=r[i+h],d=u+((d-128)*m>>8),i=r[i+k],i=v+((i-128)*o>>8),d=ImageFilters.utils.getPixelIndex(d+0.5|0,i+0.5|0,g,n,j),null===d&&(d=c)),l[c]=p[d],l[c+1]=p[d+1],l[c+2]=p[d+
2],l[c+3]=p[d+3];return a};
ImageFilters.Dither=function(a,b){var e=a.width,f=a.height,h=ImageFilters.Clone(a),k=h.data,b=2>b?2:255<b?255:b,m,o=[];m=b-1;var j=0,p=0,g;for(g=0;g<b;g+=1)o[g]=255*g/m;m=ImageFilters.utils.buildMap(function(){var a=o[j];p+=b;255<p&&(p-=255,j+=1);return a});var n,l,q,r,s,c,d,i,u=e-1,v=f-1;for(n=0;n<f;n+=1)for(g=0;g<e;g+=1)if(l=n*e+g<<2,q=k[l],r=k[l+1],s=k[l+2],c=m[q],d=m[r],i=m[s],k[l]=c,k[l+1]=d,k[l+2]=i,q-=c,r-=d,s-=i,l+=4,g<u&&(i=k[l]+0.4375*q,d=k[l+1]+0.4375*r,c=k[l+2]+0.4375*s,k[l]=255<i?255:
0>i?0:i|0,k[l+1]=255<d?255:0>d?0:d|0,k[l+2]=255<c?255:0>c?0:c|0),l+=e-2<<2,0<g&&n<v&&(i=k[l]+0.1875*q,d=k[l+1]+0.1875*r,c=k[l+2]+0.1875*s,k[l]=255<i?255:0>i?0:i|0,k[l+1]=255<d?255:0>d?0:d|0,k[l+2]=255<c?255:0>c?0:c|0),l+=4,n<v&&(i=k[l]+0.3125*q,d=k[l+1]+0.3125*r,c=k[l+2]+0.3125*s,k[l]=255<i?255:0>i?0:i|0,k[l+1]=255<d?255:0>d?0:d|0,k[l+2]=255<c?255:0>c?0:c|0),l+=4,g<u&&n<v)i=k[l]+0.0625*q,d=k[l+1]+0.0625*r,c=k[l+2]+0.0625*s,k[l]=255<i?255:0>i?0:i|0,k[l+1]=255<d?255:0>d?0:d|0,k[l+2]=255<c?255:0>c?0:
c|0;return h};ImageFilters.Edge=function(a){return ImageFilters.ConvolutionFilter(a,3,3,[-1,-1,-1,-1,8,-1,-1,-1,-1])};ImageFilters.Emboss=function(a){return ImageFilters.ConvolutionFilter(a,3,3,[-2,-1,0,-1,1,1,0,1,2])};ImageFilters.Enrich=function(a){return ImageFilters.ConvolutionFilter(a,3,3,[0,-2,0,-2,20,-2,0,-2,0],10,-40)};
ImageFilters.Flip=function(a,b){var e=a.data,f=a.width,h=a.height,k=ImageFilters.utils.createImageData(f,h),m=k.data,o,j,p,g;for(j=0;j<h;j+=1)for(o=0;o<f;o+=1)p=j*f+o<<2,g=b?(h-j-1)*f+o<<2:j*f+(f-o-1)<<2,m[g]=e[p],m[g+1]=e[p+1],m[g+2]=e[p+2],m[g+3]=e[p+3];return k};ImageFilters.Gamma=function(a,b){var e=a.data,f=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(e,f.data,function(a){a=255*Math.pow(a/255,1/b)+0.5;return 255<a?255:a+0.5|0});return f};
ImageFilters.GrayScale=function(a){for(var b=a.data,e=b.length,a=ImageFilters.utils.createImageData(a.width,a.height),f=a.data,h=0;h<e;h+=4)f[h]=f[h+1]=f[h+2]=19595*b[h]+38470*b[h+1]+7471*b[h+2]>>16,f[h+3]=b[h+3];return a};
ImageFilters.HSLAdjustment=function(a,b,e,f){var h=a.data,k=h.length,a=ImageFilters.utils.createImageData(a.width,a.height),m=a.data,b=b/360,e=e/100,f=f/100,o=ImageFilters.utils.rgbToHsl,j=ImageFilters.utils.hslToRgb,p,g,n,l;for(l=0;l<k;l+=4){n=o(h[l],h[l+1],h[l+2]);for(p=n[0]+b;0>p;)p+=1;for(;1<p;)p-=1;g=n[1]+n[1]*e;0>g?g=0:1<g&&(g=1);n=n[2];0<f?n+=(1-n)*f:0>f&&(n+=n*f);p=j(p,g,n);m[l]=p[0];m[l+1]=p[1];m[l+2]=p[2];m[l+3]=h[l+3]}return a};
ImageFilters.Invert=function(a){var b=a.data,a=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(b,a.data,function(a){return 255-a});return a};
ImageFilters.Mosaic=function(a,b){var e=a.data,f=a.width,h=a.height,k=ImageFilters.utils.createImageData(f,h),m=k.data,o=Math.ceil(f/b),j=Math.ceil(h/b),p,g,n,l,q,r,s,c,d,i,u,v,C,E,D;for(p=0;p<j;p+=1){q=p*b;r=q+b;r>h&&(r=h);for(g=0;g<o;g+=1){n=g*b;l=n+b;l>f&&(l=f);v=C=E=D=0;u=(l-n)*(r-q);for(c=q;c<r;c+=1){d=c*f;for(s=n;s<l;s+=1)i=d+s<<2,v+=e[i],C+=e[i+1],E+=e[i+2],D+=e[i+3]}v=v/u+0.5|0;C=C/u+0.5|0;E=E/u+0.5|0;D=D/u+0.5|0;for(c=q;c<r;c+=1){d=c*f;for(s=n;s<l;s+=1)i=d+s<<2,m[i]=v,m[i+1]=C,m[i+2]=E,m[i+
3]=D}}}return k};
ImageFilters.Oil=function(a,b,e){var f=a.data,h=a.width,a=a.height,k=ImageFilters.utils.createImageData(h,a),m=k.data,o=0,j=[],p=[],g=[],n=[],l=[],q=[],r,s,c,d,i,u,v,C,E,D,I;for(s=0;s<a;s+=1)for(r=0;r<h;r+=1){for(c=0;c<e;c+=1)j[c]=p[c]=g[c]=n[c]=l[c]=q[c]=0;for(c=-b;c<=b;c+=1)if(d=s+c,!(0>d||d>=a)){u=d*h;for(d=-b;d<=b;d+=1)i=r+d,0>i||i>=h||(v=u+i<<2,i=f[v],C=f[v+1],v=f[v+2],E=i*e>>8,D=C*e>>8,I=v*e>>8,n[E]+=i,l[D]+=C,q[I]+=v,j[E]+=1,p[D]+=1,g[I]+=1)}d=u=i=0;for(c=1;c<e;c+=1)j[c]>j[d]&&(d=c),p[c]>p[u]&&
(u=c),g[c]>g[i]&&(i=c);m[o]=n[d]/j[d]|0;m[o+1]=l[u]/p[u]|0;m[o+2]=q[i]/g[i]|0;m[o+3]=f[o+3];o+=4}return k};ImageFilters.OpacityFilter=function(a,b){for(var e=a.data,f=e.length,h=ImageFilters.utils.createImageData(a.width,a.height),k=h.data,m=0;m<f;m+=4)k[m]=e[m],k[m+1]=e[m+1],k[m+2]=e[m+2],k[m+3]=b;return h};
ImageFilters.Posterize=function(a,b){var e=a.data,f=ImageFilters.utils.createImageData(a.width,a.height),h=f.data,b=2>b?2:255<b?255:b,k=[],m=b-1,o=0,j=0,p;for(p=0;p<b;p+=1)k[p]=255*p/m;ImageFilters.utils.mapRGB(e,h,function(){var a=k[o];j+=b;255<j&&(j-=255,o+=1);return a});return f};ImageFilters.Rescale=function(a,b){var e=a.data,f=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(e,f.data,function(a){a*=b;return 255<a?255:a+0.5|0});return f};
ImageFilters.ResizeNearestNeighbor=function(a,b,e){var f=a.data,h=a.width,k=a.height,a=ImageFilters.utils.createImageData(b,e),m=a.data,o=h/b,k=k/e,j=0,p,g,n,l;for(n=0;n<e;n+=1){l=(n*k|0)*h;for(g=0;g<b;g+=1)p=l+g*o<<2,m[j]=f[p],m[j+1]=f[p+1],m[j+2]=f[p+2],m[j+3]=f[p+3],j+=4}return a};
ImageFilters.Resize=function(a,b,e){var f=a.data,h=a.width,a=a.height,k=ImageFilters.utils.createImageData(b,e),m=k.data,o=h/b,j=a/e,p=0,g,n;for(n=0;n<e;n+=1)for(g=0;g<b;g+=1)ImageFilters.utils.copyBilinear(f,g*o,n*j,h,a,m,p,0),p+=4;return k};
ImageFilters.ResizeBuiltin=function(a,b,e){var f=a.width,h=a.height,k=ImageFilters.utils.getSampleCanvas(),m=ImageFilters.utils.getSampleContext();k.width=Math.max(f,b);k.height=Math.max(h,e);m.save();m.putImageData(a,0,0);m.scale(b/f,e/h);m.drawImage(k,0,0);a=m.getImageData(0,0,b,e);m.restore();k.width=0;k.height=0;return a};
ImageFilters.Sepia=function(a){var b=a.data,e=b.length,a=ImageFilters.utils.createImageData(a.width,a.height),f=a.data,h,k,m,o,j;for(o=0;o<e;o+=4)h=b[o],k=b[o+1],m=b[o+2],f[o]=255<(j=0.393*h+0.769*k+0.189*m)?255:0>j?0:j+0.5|0,f[o+1]=255<(j=0.349*h+0.686*k+0.168*m)?255:0>j?0:j+0.5|0,f[o+2]=255<(j=0.272*h+0.534*k+0.131*m)?255:0>j?0:j+0.5|0,f[o+3]=b[o+3];return a};ImageFilters.Sharpen=function(a,b){return ImageFilters.ConvolutionFilter(a,3,3,[-b/16,-b/8,-b/16,-b/8,0.75*b+1,-b/8,-b/16,-b/8,-b/16])};
ImageFilters.Solarize=function(a){var b=a.data,a=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(b,a.data,function(a){return 127<a?2*(a-127.5):2*(127.5-a)});return a};ImageFilters.Transpose=function(a){var b=a.data,e=a.width,a=a.height,f=ImageFilters.utils.createImageData(a,e),h=f.data,k,m;for(y=0;y<a;y+=1)for(x=0;x<e;x+=1)k=y*e+x<<2,m=x*a+y<<2,h[m]=b[k],h[m+1]=b[k+1],h[m+2]=b[k+2],h[m+3]=b[k+3];return f};
ImageFilters.Twril=function(a,b,e,f,h,k,m){var o=a.data,j=a.width,a=a.height,p=ImageFilters.utils.createImageData(j,a),g=p.data,b=j*b,e=a*e,h=h*(Math.PI/180),n=f*f,l=0,q,r,s,c,d;for(r=0;r<a;r+=1)for(q=0;q<j;q+=1)s=q-b,c=r-e,d=s*s+c*c,d>n?(g[l]=o[l],g[l+1]=o[l+1],g[l+2]=o[l+2],g[l+3]=o[l+3]):(d=Math.sqrt(d),c=Math.atan2(c,s)+h*(f-d)/f,s=b+d*Math.cos(c),d=e+d*Math.sin(c),m?ImageFilters.utils.copyBilinear(o,s,d,j,a,g,l,k):(d=(d+0.5|0)*j+(s+0.5|0)<<2,g[l]=o[d],g[l+1]=o[d+1],g[l+2]=o[d+2],g[l+3]=o[d+3])),
l+=4;return p};(function(){var a,b,e,f,h,k,m,o,j,p,g,n,l,q,r=[].slice;a={};window.Franz=a;b=function(a,c){for(;!a;)throw Error("Callback required for "+c);return[]};p=function(a){var c;c=[];return a&&"[object Function]"===c.toString.apply(a)};l=function(){var a,c;a=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];a&&p(a)&&window.setTimeout.apply(window,[a,0].concat(r.call(c)));return null!=c?c[0]:void 0};h=function(){var a,c,d,i,b,e,h,f,l;e=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];d=null;
b=[];i=0;h=function(a){return p(a)&&!d?d=a:b.push(a)};f=0;for(l=e.length;f<l;f++)a=e[f],h(a);e=function(a){var d;return null!=(d=b[i])?d:b[i]=a};i=h=0;for(f=c.length;h<f;i=++h)a=c[i],e(a);d||(d=function(){return null});b.unshift(d);return b};k=function(){var a,c,d,i,b,e,h,f,l;e=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];d=null;b=[];i=0;h=function(a){return p(a)&&!d?d=a:b.push(a)};f=0;for(l=e.length;f<l;f++)a=e[f],h(a);e=function(a){var d;return null!=(d=b[i])?d:b[i]=a};i=h=0;for(f=
c.length;h<f;i=++h)a=c[i],e(a);d||(d=!1);b.unshift(d);return b};j=function(){var a,c,d,i,b,e,h;a=arguments[0];c=arguments[1];d=arguments[2];e=4<=arguments.length?r.call(arguments,3):[];h=o(a);a=h[0];i=h[2];h=q(a);a=h[0];b=h[1];l(function(){return b.putImageData(d.apply(null,[i].concat(r.call(e))),0,0)});return l(c,a)};g=function(){var a,c;c=arguments[0];a=2<=arguments.length?r.call(arguments,1):[];return function(){var d,i,b;d=arguments[0];i=2<=arguments.length?r.call(arguments,1):[];b=h(i,a);i=b.shift();
return j.apply(null,[d,i,c].concat(r.call(b)))}};a.clamp=e=function(a,c,d){null==c&&(c=0);null==d&&(d=255);return Math.min(d,Math.max(c,a))};a.getToolbox=o=function(a,c){var d,i;return l(c,[a,d=a.getContext("2d"),i=d.getImageData(0,0,a.width,a.height),i.data])};a.make=n=function(){var a,c,d,i,b;c=1<=arguments.length?r.call(arguments,0):[];a=h(c,800,600);c=a[0];b=a[1];d=a[2];i=a[3];b.width&&b.height&&(a=b,b=a.width,d=a.height,i=(null!=a?"function"===typeof a.getAttribute?a.getAttribute("id"):void 0:
void 0)||(null!=a?"function"===typeof a.getAttribute?a.getAttribute("origin"):void 0:void 0));a=document.createElement("canvas");a.width=b;a.height=d;i&&a.setAttribute("origin",i);return l(c,a)};a.newToolbox=q=function(){var s,c;s=1<=arguments.length?r.call(arguments,0):[];c=h(s);s=c[0];return a.getToolbox(n(c[1],c[2],c[3]),s)};a.copy=f=function(s,c){var d,i;i=a.newToolbox(s);d=i[0];i[1].drawImage(s,0,0,s.width,s.height);return l(c,d)};a.byImage=function(s,c){if(s.width&&s.height)return f(s,c);b(c,
'Franz.byImage (only if the image is not "loaded")');p(c)&&(s.onload=function(){return a.byImage(s,c)});return!0};a.byArray=function(a,c,d,i){var b,e,h;b=q(c,d);c=b[0];d=b[1];e=b[2];h=b[3];for(b=0;b<h.length;)h[b]=a[b],b+=1;d.putImageData(e,0,0);return l(i,c)};a.toImage=function(){var a,c,d,i;a=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];d=h(c,"image/png");c=d[0];i=d[1];d=new Image;d.src=a.toDataURL(i,"");return l(c,d)};a.toArray=function(a){var c,d;c=[];d=o(a)[3];Uint8Array&&(c=new Uint8Array(new ArrayBuffer(d.length)));
for(a=0;a<d.length;)c[a]=d[a],a+=1;return c};a.rgba=function(){var s,c,d,i,b,e,f,k,j,g,m,n,q,B,A,t;d=arguments[0];i=2<=arguments.length?r.call(arguments,1):[];b=h(i,null,!1);i=b[0];e=b[1];b=b[2];if(!p(e))return!1;g=o(d);d=g[0];g=g[3];s=[d.width,d.height];q=s[0];k=s[1];n=new Uint8Array(new ArrayBuffer(g.length));for(A=0;A<k;){B=0;for(t=A*q;B<q;)m=j=4*(t+B),f=j+1,c=j+2,s=j+3,j=b?e(g[m],g[f],g[c],g[s],j,d):e(g[m],g[f],g[c],g[s],j),n[m]=j[0],n[f]=j[1],n[c]=j[2],n[s]=j[3],B+=1;A+=1}d=a.byArray(n,q,k);
return l(i,d)};a.getGrayscaleValue=m=function(a,c,d){return 0.3*a+0.59*c+0.11*d};a.hardResize=function(s,c,d,b){var e,h;h=a.newToolbox(c,d);e=h[0];h[1].drawImage(s,0,0,c,d);return l(b,e)};a.resize=function(){var a,c,d,b,e,f,g;a=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];b={width:null,height:null};e={width:null,height:null};f=h(c,800,null,null,null,null,null);c=f[0];b.width=f[1];b.height=f[2];e.width=f[3];e.height=f[4];d=f[5];f={width:null,height:null};"width"===d?g="height":"height"===
d?g="width":a.height>a.width?(d="height",g="width"):(d="width",g="height");console.log("hallo");b[d]&&(a[d]>b[d]||a[g]>b[g])?(f[g]=a[g]*b[d]/a[d],f[d]=b[d],f[g]>b[g]&&(f[d]=a[d]*b[g]/a[g],f[g]=b[g])):e[d]&&(a[d]<e[d]||a[g]>e[g])?(f[d]=a[d]*e[g]/a[g],f[g]=e[g],f[d]<e[d]&&(f[g]=a[g]*e[d]/a[d],f[d]=e[d])):(f[d]=a[d],f[g]=a[g]);e=q(f.width,f.height,(null!=a?a.getAttribute("id"):void 0)||(null!=a?a.getAttribute("origin"):void 0));b=e[0];e[1].drawImage(a,0,0,f.width,f.height);return l(c,b)};a.scale=function(){var a,
c,d,b,e,f;a=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];e=h(c,1);c=e[0];d=e[1];e=a.width*d;b=a.height*d;f=q(e,b,(null!=a?a.getAttribute("id"):void 0)||(null!=a?a.getAttribute("origin"):void 0));d=f[0];f[1].drawImage(a,0,0,e,b);return l(c,d)};a.crop=function(){var a,c,d,b,e,f,g,j;a=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];d=h(c,0,0,a.width/2,a.height/2);c=d[0];e=d[1];f=d[2];b=d[3];d=d[4];j=q(b,d,(null!=a?a.getAttribute("id"):void 0)||(null!=a?a.getAttribute("origin"):
void 0));g=j[0];j[1].drawImage(a,e,f,b,d,0,0,b,d);return l(c,g)};a.rotateRight=function(a,c){var d;d=q(a)[1];d.rotate(90*Math.PI/180);d.drawImage(a,0,-1*a.height);return l(c,a)};a.rotateLeft=function(a,c){var d;d=q(a)[1];d.rotate(-90*Math.PI/180);d.drawImage(a,-1*a.width,0);return l(c,a)};a.flip=function(a,c){var d;d=q(a)[1];d.rotate(Math.PI);d.drawImage(a,-1*a.width,-1*a.height);return l(c,a)};a.mirror=function(a,c){var d;d=q(a)[1];d.translate(c2.width/2,0);d.scale(-1,1);d.drawImage(a,-1*(c2.width/
2),0);return l(c,a)};a.merge=function(){var b,c,d,i;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];i=h(c,null);c=i[0];for(i=i[1];!i;)return!1;d=a.getToolbox(a.hardResize(i,b.width,b.height))[3];return a.rgba(b,c,function(a,c,b,i,s){a=e(a*d[s]/255);c=e(c*d[s+1]/255);b=e(b*d[s+2]/255);return[a,c,b,i]})};a.hardmerge=function(){var b,c,d,e,g,j;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];d=h(c,null,"source-over",1);c=d[0];j=d[1];d=d[3];g=a.getToolbox(f(b));e=g[0];g=g[1];b=
a.getToolbox(a.hardResize(j,b.width,b.height))[0];g.globalCompositeOperation=d;g.drawImage(b,0,0);return l(c,e)};a.negmerge=function(){var b,c,d,i;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];i=h(c,null);c=i[0];for(i=i[1];!i;)return!1;d=a.getToolbox(a.hardResize(i,b.width,b.height))[3];return a.rgba(b,c,function(a,c,b,i,s){a=e(255*(a/d[s]));c=e(255*(c/d[s+1]));b=e(255*(b/d[s+2]));return[a,c,b,i]})};a.lightmerge=function(){var b,c,d,e;b=arguments[0];c=2<=arguments.length?r.call(arguments,
1):[];e=h(c,null);c=e[0];for(e=e[1];!e;)return!1;d=a.getToolbox(a.hardResize(e,b.width,b.height))[3];return a.rgba(b,c,function(a,c,b,e,i){a=a>d[i]?a:d[i];c=c>d[i+1]?c:d[i+1];b=b>d[i+2]?b:d[i+2];return[a,c,b,e]})};a.darkmerge=function(){var b,c,d,e;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];e=h(c,null);c=e[0];for(e=e[1];!e;)return!1;d=a.getToolbox(a.hardResize(e,b.width,b.height))[3];return a.rgba(b,c,function(a,c,b,e,i){a=a<d[i]?a:d[i];c=c<d[i+1]?c:d[i+1];b=b<d[i+2]?b:d[i+2];return[a,
c,b,e]})};a.lightermerge=function(){var b,c,d,e;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];e=h(c,null);c=e[0];for(e=e[1];!e;)return!1;d=a.getToolbox(a.hardResize(e,b.width,b.height))[3];return a.rgba(b,c,function(a,c,b,e,i){var s,a=(s=m(a,c,b)>m(d[i],d[i+1],d[i+2])?!0:!1)?a:d[i],c=s?c:d[i+1],b=s?b:d[i+2];return[a,c,b,e]})};a.darkermerge=function(){var b,c,d,e;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];e=h(c,null);c=e[0];for(e=e[1];!e;)return!1;d=a.getToolbox(a.hardResize(e,
b.width,b.height))[3];return a.rgba(b,c,function(a,c,b,e,i){var s,a=(s=m(a,c,b)<m(d[i],d[i+1],d[i+2])?!0:!1)?a:d[i],c=s?c:d[i+1],b=s?b:d[i+2];return[a,c,b,e]})};a.blend=function(){var b,c,d,i,f,g,j;c=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];j=h(d,null,0.5);d=j[0];g=j[1];for(b=j[2];!g;)return!1;f=a.getToolbox(a.hardResize(g,c.width,c.height))[3];i=1-b;return a.rgba(c,d,function(a,d,c,h,g){a=e(a*i+f[g]*b);d=e(d*i+f[g+1]*b);c=e(c*i+f[g+2]*b);return[a,d,c,h]})};a.viewfinder=function(){var e,
c,d,i;e=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];d=k(d,"./img/viewfinder.png");c=d[0];d=d[1];b(c,"Franz.viewfinder");i=new Image;i.onload=function(){return a.merge(e,i,c)};i.src=d;return!0};a.oldschool=function(){var e,c,d,i;e=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];d=k(d,"./img/oldschool.png");c=d[0];d=d[1];b(c,"Franz.oldschool");i=new Image;i.onload=function(){return a.lightermerge(e,i,c)};i.src=d;return!0};a.rgbaAd=function(){var b,c,d,i,f,g,j;d=arguments[0];
i=2<=arguments.length?r.call(arguments,1):[];j=h(i,0,0,0,0);i=j[0];g=j[1];f=j[2];c=j[3];b=j[4];return a.rgba(d,i,function(a,d,i,h){return[e(h+g),e(d+f),e(i+c),e(h+b)]})};a.adBrighter=function(){var b,c,d;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];d=h(c,0);c=d[0];d=d[1];return a.rgbaAd(b,d,d,d,0,c)};a.adDarker=function(){var b,c;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];c=h(c,0);return a.brighter(b,-1*c[1],c[0])};a.adOpacity=function(){var b,c;b=arguments[0];c=2<=
arguments.length?r.call(arguments,1):[];c=h(c,0);return a.rgbaAd(b,0,0,0,c[1],c[0])};a.rgbaMultiply=function(){var b,c,d,i,f,g;d=arguments[0];i=2<=arguments.length?r.call(arguments,1):[];g=h(i,1,1,1,1);i=g[0];f=g[2];c=g[3];b=g[4];return a.rgba(d,i,function(a,d,i,h){return[e(h*b),e(d*f),e(i*c),e(h*b)]})};a.brighter=function(){var b,c,d;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];d=h(d,1);c=d[0];d=d[1];return a.rgbaMultiply(b,d,d,d,1,c)};a.darker=function(){var b,c,d;b=arguments[0];
d=2<=arguments.length?r.call(arguments,1):[];d=h(d,1);c=d[0];d=d[1];d=2-d;return a.rgbaMultiply(b,d,d,d,1,c)};a.opacity=function(){var b,c;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];c=h(c,1);return a.rgbaMultiply(b,1,1,1,c[1],c[0])};a.many=function(){var e,c,d,i,f,g,j;d=arguments[0];e=2<=arguments.length?r.call(arguments,1):[];e=h(e);i=e[0];c=e[1];g=e[2];b(i);e=null!=(f=null!=c?c.shift():void 0)?f:null;for(f=null!=(j=null!=g?g.shift():void 0)?j:[];!Array.isArray(f);)f=[f];return 0<
c.length?e.apply(null,[d,function(d){return a.many(d,i,c,g)}].concat(r.call(f))):e(d,i,f)};a.applyIfRgba=function(b,c,d,e,f){var h;h=a.copy(b);h=a.getToolbox(h)[0];return a.many(b,[c],[d],function(d){var b,c;c=a.getToolbox(d);d=c[0];b=c[3];a.newToolbox(d);return a.rgba(h,f,function(a,d,c,f,h){return e(a,d,c,f,h)?[b[h],b[h+1],b[h+2],b[h+3]]:[a,d,c,f,h]})})};a.preserveGreen=function(b,c){return a.applyIfRgba(b,a.blackWhite,[],function(a,b,c){return a>b||c>b?!0:!1},c)};a.preserveBlue=function(b,c){return a.applyIfRgba(b,
a.blackWhite,[],function(a,b,c){return a>c||b>c?!0:!1},c)};a.preserveRed=function(b,c){return a.applyIfRgba(b,a.blackWhite,[],function(a,b,c){return b>a||c>a?!0:!1},c)};a.preserveYellow=function(){var b,c,d,e,f,g;c=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];g=h(d,127,127,50);d=g[0];f=g[1];e=g[2];b=g[3];return a.applyIfRgba(c,a.blackWhite,[],function(a,d,c){return a>f&&d>e&&c<b?!1:!0},d)};a.nothing=function(){var b,c;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];c=h(c)[0];
return a.rgba(b,c,function(a,b,c,e){return[a,b,c,e]})};a.invert=function(){var b,c;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];c=h(c)[0];return a.rgba(b,c,function(a,b,c,e){return[255-a,255-b,255-c,e]})};a.saturate=function(){var b,c,d,i;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];i=h(c,0.3);c=i[0];d=i[1];return a.rgba(b,c,function(a,b,c,i){var f;f=(a+b+c)/3;return[e(f+d*(a-f)),e(f+d*(b-f)),e(f+d*(c-f)),i]})};a.desaturate=function(){var b,c;b=arguments[0];c=2<=arguments.length?
r.call(arguments,1):[];c=h(c,0.7);return a.saturate(b,1-c[1],c[0])};a.fill=function(){var b,c,d,i,f,g;c=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];g=h(d,0,0,0);d=g[0];f=g[1];i=g[2];b=g[3];return a.rgba(c,d,function(a,c,d,h){return[e(f),e(i),e(b),h]})};a.posterize=function(){var b,c,d,i;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];i=h(c,5);c=i[0];d=Math.floor(255/i[1]);return a.rgby(b,c,function(a,b,c,i){a=e(Math.floor(a/d)*d);b=e(Math.floor(b/d)*d);c=e(Math.floor(c/d)*
d);return[a,b,c,i]})};a.grayScale=function(a,b){return doRgbaFilter(a,b,function(a,b,c,e){a=(a+b+c)/3;return[a,a,a,e]})};a.tint=function(){var b,c,d,i,f,g,j,l,k;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];k=h(c,85,85,85,170,170,170);c=k[0];l=k[1];j=k[2];g=k[3];f=k[4];d=k[5];i=k[6];l===f&&(f+=1);j===i&&(i+=1);g===d&&(d+=1);return a.rgba(b,c,function(a,b,c,h){a=e((a-l)*(255/(f-l)));b=e((b-l)*(255/(i-j)));c=e((c-g)*(255/(d-g)));return[a,b,c,h]})};a.sepia=function(b,c){return a.rgba(b,
c,function(a,b,c,f){var h,g;g=0.349*a+0.686*b+0.168*c;h=0.272*a+0.534*b+0.131*c;return[e(0.393*a+0.769*b+0.189*c),e(g),e(h),f]})};a.blackWhite=function(b,c){return a.rgba(b,c,function(a,b,c,e){a=0.3*a+0.59*b+0.11*c;return[a,a,a,e]})};a.solarize=function(b,c){return a.rgba(b,c,function(a,b,c,e){return[127<a?255-a:a,127<b?255-b:b,127<c?255-c:c,e]})};a.screen=function(){var b,c,d,e,f,g,j;c=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];j=h(d,227,12,169,0.2);d=j[0];f=j[1];e=j[2];b=j[3];g=j[4];
return a.rgba(c,d,function(a,c,d,h){return[255-(255-a)*(255-f*g)/255,255-(255-c)*(255-e*g)/255,255-(255-d)*(255-b*g)/255,h]})};a.noise=function(){var a,b,d,i,g,j,k,m,n,p,q;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];a=h(d,20);d=a[0];a=a[1];i=o(f(b));b=i[0];j=i[1];k=i[2];m=i[3];i=p=0;for(q=m.length;p<q;i=++p){n=Math.round(a-Math.random()*a/2);for(g=0;3>g;)m[i+g]=e(n+m[i+g]),g+=1}j.putImageData(k,0,0);return l(d,b)};a.threshold=function(){var b,c,d,e;b=arguments[0];c=2<=arguments.length?
r.call(arguments,1):[];e=h(c,128);c=e[0];d=e[1];return a.rgba(b,c,function(a,c,e,f){b=a>d||c>d||e>d?255:0;return[b,b,b,f]})};a.vignette=function(){var a,b,d,e,g,j,k;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];a=h(d,0.2,0.8);d=a[0];k=a[1];a=a[2];e=o(f(b));b=e[0];g=e[1];j=Math.sqrt(Math.pow(b.width/2,2)+Math.pow(b.height/2,2));g.globalCompositeOperation="source-over";e=g.createRadialGradient(b.width/2,b.height/2,0,b.width/2,b.height/2,j);e.addColorStop(0,"rgba(0,0,0,0)");e.addColorStop(0.65,
"rgba(0,0,0,0)");e.addColorStop(1,"rgba(0,0,0,"+a+")");g.fillStyle=e;g.fillRect(0,0,b.width,b.height);g.globalCompositeOperation="lighter";e=g.createRadialGradient(b.width/2,b.height/2,0,b.width/2,b.height/2,j);e.addColorStop(0,"rgba(255,255,255,"+k+")");e.addColorStop(0.65,"rgba(255,255,255,0)");e.addColorStop(1,"rgba(0,0,0,0)");g.fillStyle=e;g.fillRect(0,0,b.width,b.height);return l(d,b)};a.schemer=function(){var b,c,d,f,g,j,k,l,m,n,o;g=arguments[0];j=2<=arguments.length?r.call(arguments,1):[];
k=h(j,[],[],[],[],[],[],[],[]);j=k[0];n=k[1];l=k[2];d=k[3];b=k[4];o=k[5];m=k[6];f=k[7];c=k[8];k=function(a,b){return a-b};n=n.sort(k);l=l.sort(k);d=d.sort(k);b=b.sort(k);return a.rgba(g,j,function(a,g,h,j){var k,p,r,q,v,u,C,w,P,M,O,R;k=[a,g,h,j];v=k[0];r=k[1];p=k[2];k=k[3];if(0<n.length){q=C=0;for(O=n.length;C<O;q=++C)if(u=n[q],a<=u){v=null!=(w=o[q])?w:u;break}}if(0<l.length){q=w=0;for(u=l.length;w<u;q=++w)if(a=l[q],g<=a){r=null!=(P=m[q])?P:a;break}}if(0<d.length){q=P=0;for(a=d.length;P<a;q=++P)if(g=
d[q],h<=g){p=null!=(M=f[q])?M:g;break}}if(0<b.length){q=M=0;for(g=b.length;M<g;q=++M)if(h=b[q],j<=h){k=null!=(R=c[q])?R:h;break}}return[e(v),e(r),e(p),e(k)]})};a.reduceAndReplace=function(){var b,c,d,e,f,g;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];d={c64:[[0,0,0],[255,255,255],[116,67,53],[124,172,186],[123,72,144],[100,151,79],[64,50,133],[191,205,122],[123,91,47],[79,69,0],[163,114,101],[80,80,80],[120,120,120],[164,215,142],[120,106,189],[159,159,159]]};f=h(c,d.c64);c=f[0];f=
f[1];Array.isArray(f)||(f=d[f]);e=f.length;g=f.sort(function(a,b){return(3*a[0]+4*a[1]+a[2]>>>3)-(3*b[0]+4*b[1]+b[2]>>>3)});return a.rgba(b,c,function(a,b,c,d){a=g[Math.floor((3*a+4*b+c>>>3)/256*e)];return[a[0],a[1],a[2],d]})};a.c64=function(b,c){return a.reduceAndReplace(b,c)};a.ascii=function(){var a;a=2<=arguments.length?r.call(arguments,1):[];h(a,"@GLftli;:,.  ");return asciistring.split("").length};a.removeNoise=function(){var b,c,d,e,f,g,j,k,m,n,p,q,z,B,A,t,J,Q,N,H,K,L,w;g=arguments[0];j=2<=
arguments.length?r.call(arguments,1):[];j=h(j)[0];t=o(g);g=t[0];t=t[3];p=[g.width,g.height];g=p[0];p=p[1];H=new Uint8Array(new ArrayBuffer(t.length));for(L=0;L<p;){J=L===p?L:L+1;Q=0===L?0:L-1;K=0;for(w=L*g;K<g;)b=4*(w+K),c=K===g?K:K+1,f=4*(J*g+c),d=4*(Q*g+c),N=b,k=b+1,c=b+2,b+=3,A=z=t[d],q=t[N-4],B=t[N+4],e=t[f],q<A&&(A=q),B<A&&(A=B),e<A&&(A=e),q>z&&(z=q),B>z&&(z=B),e>z&&(z=e),B=q=t[d+1],e=t[k-4],m=t[k+4],n=t[f+1],e<B&&(B=e),m<B&&(B=m),n<B&&(B=n),e>q&&(q=e),m>q&&(q=m),n>q&&(q=n),n=m=t[d+2],d=t[c-
4],e=t[c+4],f=t[f+2],d<n&&(n=d),e<n&&(n=e),f<n&&(n=f),d>m&&(m=d),e>m&&(m=e),f>m&&(m=f),N>z?H[N]=z:N<A&&(H[N]=A),k>q?H[k]=q:k<B&&(H[k]=B),c>m?H[c]=m:c<n&&(H[c]=n),H[b]=t[b],K+=1;L+=1}t=a.byArray(H,g,p);return l(j,t)};a.curve=function(){var b,c,d,e,f,g;c=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];g=h(d,[0,0,0,1,1,2,3,3,3,4,4,4,5,5,5,6,6,7,7,7,7,8,8,8,9,9,9,9,10,10,10,10,11,11,12,12,12,12,13,13,13,14,14,15,15,16,16,17,17,17,18,19,19,20,21,22,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,
37,39,40,41,42,44,45,47,48,49,52,54,55,57,59,60,62,65,67,69,70,72,74,77,79,81,83,86,88,90,92,94,97,99,101,103,107,109,111,112,116,118,120,124,126,127,129,133,135,136,140,142,143,145,149,150,152,155,157,159,162,163,165,167,170,171,173,176,177,178,180,183,184,185,188,189,190,192,194,195,196,198,200,201,202,203,204,206,207,208,209,211,212,213,214,215,216,218,219,219,220,221,222,223,224,225,226,227,227,228,229,229,230,231,232,232,233,234,234,235,236,236,237,238,238,239,239,240,241,241,242,242,243,244,
244,245,245,245,246,247,247,248,248,249,249,249,250,251,251,252,252,252,253,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[0,0,1,2,2,3,5,5,6,7,8,8,10,11,11,12,13,15,15,16,17,18,18,19,21,22,22,23,24,26,26,27,28,29,31,31,32,33,34,35,35,37,38,39,40,41,43,44,44,45,46,47,48,50,51,52,53,54,56,57,58,59,60,61,63,64,65,66,67,68,69,71,72,73,74,75,76,77,79,80,81,83,84,85,86,88,89,90,92,93,94,95,96,97,100,101,102,103,105,106,107,
108,109,111,113,114,115,117,118,119,120,122,123,124,126,127,128,129,131,132,133,135,136,137,138,140,141,142,144,145,146,148,149,150,151,153,154,155,157,158,159,160,162,163,164,166,167,168,169,171,172,173,174,175,176,177,178,179,181,182,183,184,186,186,187,188,189,190,192,193,194,195,195,196,197,199,200,201,202,202,203,204,205,206,207,208,208,209,210,211,212,213,214,214,215,216,217,218,219,219,220,221,222,223,223,224,225,226,226,227,228,228,229,230,231,232,232,232,233,234,235,235,236,236,237,238,238,
239,239,240,240,241,242,242,242,243,244,245,245,246,246,247,247,248,249,249,249,250,251,251,252,252,252,253,254,255],[53,53,53,54,54,54,55,55,55,56,57,57,57,58,58,58,59,59,59,60,61,61,61,62,62,63,63,63,64,65,65,65,66,66,67,67,67,68,69,69,69,70,70,71,71,72,73,73,73,74,74,75,75,76,77,77,78,78,79,79,80,81,81,82,82,83,83,84,85,85,86,86,87,87,88,89,89,90,90,91,91,93,93,94,94,95,95,96,97,98,98,99,99,100,101,102,102,103,104,105,105,106,106,107,108,109,109,110,111,111,112,113,114,114,115,116,117,117,118,
119,119,121,121,122,122,123,124,125,126,126,127,128,129,129,130,131,132,132,133,134,134,135,136,137,137,138,139,140,140,141,142,142,143,144,145,145,146,146,148,148,149,149,150,151,152,152,153,153,154,155,156,156,157,157,158,159,160,160,161,161,162,162,163,164,164,165,165,166,166,167,168,168,169,169,170,170,171,172,172,173,173,174,174,175,176,176,177,177,177,178,178,179,180,180,181,181,181,182,182,183,184,184,184,185,185,186,186,186,187,188,188,188,189,189,189,190,190,191,191,192,192,193,193,193,194,
194,194,195,196,196,196,197,197,197,198,199]);d=g[0];f=g[1];e=g[2];b=g[3];return a.rgba(c,d,function(a,c,d,g){return[f[a],e[c],b[d],g]})};a.binarize=g(ImageFilters.Binarize,0.5);a.boxBlur=g(ImageFilters.BoxBlur,3,3,2);a.gaussianBlur=g(ImageFilters.GaussianBlur,2);a.stackBlur=g(ImageFilters.StackBlur,6);a.brightness=g(ImageFilters.brightness,1);a.brightnessConstrastGimp=g(ImageFilters.BrightnessContrastGimp,50,50);a.brightnessConstrastPhotoshop=g(ImageFilters.BrightnessContrastPhotoshop,50,50);a.Channels=
function(a){return g(ImageFilters.Channels,"blue"===a||"b"===a?3:"green"===a||"g"===a?2:a)};a.colorTransform=g(ImageFilters.ColorTransformFilter,1,1,1,0,0,0);a.dither=g(ImageFilters.Dither,2);a.edge=g(ImageFilters.Edge);a.emboss=g(ImageFilters.Emboss);a.enrich=g(ImageFilters.Enrich);a.gamma=g(ImageFilters.Gamma,2);a.HSLAdjustment=g(ImageFilters.HSLAdjustment,0,0,0);a.mosaic=g(ImageFilters.Mosaic,10);a.oil=g(ImageFilters.Oil,4,30);a.sharpen=g(ImageFilters.Sharpen,3);a.twirl=g(ImageFilters.Twril,0.5,
0.5,100,360)}).call(this);
